<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html">

<h:head>
<title>Seguimiento</title>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet' />	
<div id='map'></div>  

<script type="text/javascript">

	function onCall(form) {  
		lat=form["formname:lati"].value;
		lon=form["formname:longi"].value;

		document.getElementById("map").style.position="absolute";
		document.getElementById("map").style.top= "50px";
		document.getElementById("map").style.bottom= "0";
		document.getElementById("map").style.width= "100%";
		

		mapboxgl.accessToken = 'pk.eyJ1IjoiYmFiYWxpZXIiLCJhIjoiY2p0d3d3dDExMHRkeDQ0cGxqM2h4ZnBmbSJ9.ApporbXy5_wb4TjEUHnWmQ';
		var map = new mapboxgl.Map({
			container: 'map',
			style: 'mapbox://styles/mapbox/streets-v11',
			zoom: 18,
			center: [lon, lat]
			});

		
		map.on('load', function() {
			mapboxgl.accessToken = 'pk.eyJ1IjoiYmFiYWxpZXIiLCJhIjoiY2p0d3d3dDExMHRkeDQ0cGxqM2h4ZnBmbSJ9.ApporbXy5_wb4TjEUHnWmQ';
			map.loadImage('https://thumbs.dreamstime.com/z/el-autob%C3%BAs-para-dise%C3%B1o-aislado-perno-del-icono-de-la-ubicaci%C3%B3n-74194648.jpg', function(error, image) {
			if (error) throw error;
				map.addImage('cat', image);
				map.addLayer({
				"id": "points",
				"type": "symbol",
				"source": {
				"type": "geojson",
				"data": {
				"type": "FeatureCollection",
				"features": [{
				"type": "Feature",
				"geometry": {
				"type": "Point",
				"coordinates": [lon, lat]
				}
				}]
				}
				},
				"layout": {
				"icon-image": "cat",
				"icon-size": 0.025
				}
			});
			});
			});	
	}

</script>
</h:head>


<h:body>
<h:form id="formname">
	<h:commandButton action="#{temporizadorMB.preparaCoordenada()}" value="Actualiza" />
	<h:inputHidden id="lati" value="#{temporizadorMB.latitud}" />
	<h:inputHidden id="longi" value="#{temporizadorMB.longitud}" />
	<h:commandButton value="Ver Mapa" onclick="onCall(this.form); return false;"/>
</h:form>
</h:body>	
</html>